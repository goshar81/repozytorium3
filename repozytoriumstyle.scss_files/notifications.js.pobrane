App.Views.NotificationsView=Backbone.View.extend({events:{click:"notificationHasClicked"},initialize:function(){this.getContactDetails()},getContactDetails:function(){Cookies.get("activeCampaignContactId")&&Cookies.get("activeCampaignContactEmail")?$.ajax({url:"/"+App.getLang()+"/activeCampaign/contact",method:"GET",data:{id:Cookies.get("activeCampaignContactId"),email:Cookies.get("activeCampaignContactEmail")},success:function(a){var b=this.prepareContactData(a);this.getNotification(b)}.bind(this)}):this.getNotification({})},prepareContactData:function(a){var b={visitedPages:this.getVisitedPages(a.actions),fields:this.getFields(a),tags:a.tags};return b},getFields:function(a){var b={EMAIL:a.email,NAME:a.name,PHONE:a.phone};for(var c in a.fields){var d=a.fields[c];b[d.perstag]=d.val}return b},getVisitedPages:function(a){var b=[];if("undefined"!=typeof a)for(var c=0;c<a.length;c++){var d,e=a[c].text;e.indexOf("Visited page")!==-1&&(d=e.split("- ")[1],b.indexOf(d)===-1&&b.push(d))}return"production"!==window.environment&&console.log("Visited pages delivered by AC:",b),b},getNotification:function(a){$.ajax({url:"/"+App.getLang()+"/notification",method:"POST",data:{visitedPages:a.visitedPages,fields:a.fields,tags:a.tags,path:window.location.pathname.substr(1),queryParams:App.GetQueryParams()},success:function(a){var b=$(this.el);this.notificationId=a.id,b.html(a.content).animate({bottom:"50px"},400,function(){b.animate({bottom:"20px"},300)}),$(window).width()>543&&b.fadeIn()}.bind(this)})},notificationHasClicked:function(){Cookies.set("notificationHasClicked_"+this.notificationId,!0,{expires:730,path:"/"})}}),new App.Views.NotificationsView({el:$('[data-role="notifications-wrapper"]')});