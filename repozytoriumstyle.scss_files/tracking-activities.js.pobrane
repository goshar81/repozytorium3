App.Services.TrackingActivitiesService=Backbone.View.extend({initialize:function(){this.increaseWebSessions(),this.increaseVisitedWebPages(),this.fillFirstSeenDate(),this.utm(),this.updateUserData(),this.checkIfUserIsRegistered(),this.checkIfUserHasConversations(),this.checkIfUserHasCallData()},increaseFieldsByOne:function(a){var b=Cookies.get("activeCampaignContactId"),c=Cookies.get("activeCampaignContactEmail");b&&c&&$.ajax({url:"/"+App.getLang()+"/activeCampaign/increaseByOne",method:"POST",data:{id:b,email:c,fields:a}})},increaseVisitedWebPages:function(){var a=this,b=window.location.pathname,c={bootcampJava:{regex:/bootcamp\/java$/,acField:"VISITED_PAGE_BOOTCAMP_JAVA"},bootcampWebdeveloper:{regex:/bootcamp\/webdeveloper$/,acField:"VISITED_PAGE_BOOTCAMP_WEBDEVELOPER"}};$.each(c,function(c,d){d.regex.test(b)&&a.increaseFieldsByOne([d.acField])})},increaseWebSessions:function(){if("undefined"==typeof Cookies.get("visited")){if("undefined"==typeof Cookies.get("activeCampaignContactId")||"undefined"==typeof Cookies.get("activeCampaignContactEmail"))return;Cookies.set("visited",!0,{expires:730,path:"/"}),this.increaseFieldsByOne(["WEB_SESSIONS"])}},fillFirstSeenDate:function(){"undefined"==typeof Cookies.get("firstSeen")&&Cookies.set("firstSeen",$.format.date(new Date,"yyyy-MM-dd HH:mm:ss"),{expires:730,path:"/"})},utm:function(){var a,b,c,d=["utm_source","utm_campaign","utm_medium"],e=Cookies.get("activeCampaignContactId"),f=Cookies.get("activeCampaignContactEmail"),g=new Object({});d.forEach(function(d){a=Cookies.get(d),g[d]=e&&f||!a?"":a,b=App.GetQueryParamByName(d),b&&(c=!0,g[d]+=b+" ")});var h=document.referrer;if(""===g.utm_source&&h&&h.indexOf("://kodilla")===-1&&(g.utm_source=h+" ",c=!0),e&&f&&c)$.ajax({url:"/"+App.getLang()+"/activeCampaign/updateUtm",method:"PUT",data:{id:Cookies.get("activeCampaignContactId"),email:Cookies.get("activeCampaignContactEmail"),utm:g},success:function(){d.forEach(function(a){Cookies.remove(a,{path:"/"})})}});else if((!e||!f)&&c)for(var i in g)g[i]&&Cookies.set(i,g[i],{expires:730,path:"/"})},updateUserData:function(){return"undefined"!=typeof Cookies.get("activeCampaignContactId")&&"undefined"!=typeof Cookies.get("activeCampaignContactEmail")&&void $.ajax({url:"/"+App.getLang()+"/activeCampaign/updateContact",method:"POST",data:{id:Cookies.get("activeCampaignContactId"),email:Cookies.get("activeCampaignContactEmail"),lastSeen:$.format.date(new Date,"yyyy-MM-dd hh:mm:ss")}})},checkIfUserIsRegistered:function(){return(window.loggedIn===!0||"undefined"!=typeof Cookies.get("isRegistered"))&&(Cookies.set("isRegistered",!0,{expires:730,path:"/"}),!0)},checkIfUserHasConversations:function(){var a=this,b=Cookies.get("intercom-id-wgw0vvdj");if(!b||!Cookies.get("activeCampaignContactId")||!Cookies.get("activeCampaignContactEmail"))return!1;var c=new XMLHttpRequest;c.open("GET","https://api-iam.intercom.io/messenger/web/conversations?app_id=wgw0vvdj&platform=web&user_data%5Banonymous_id%5D="+b),c.onload=function(){if(200===c.status){var b=a.getIntercomConversationsData(JSON.parse(c.responseText).conversations);if(b.length)return a.updateIntercomData(b)}},c.send()},getIntercomConversationsData:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];if(d.user_participated){var e=new Date(1e3*d.updated_at);e=$.format.date(e,"yyyy-MM-dd HH:mm:ss"),b.push("(Data ostatniej wiadomości: "+e+") https://app.intercom.io/a/apps/wgw0vvdj/respond/inbox/conversation/"+d.id)}}return b.join(", ")},updateIntercomData:function(a){return $.ajax({url:"/"+App.getLang()+"/activeCampaign/updateContact",method:"POST",data:{id:Cookies.get("activeCampaignContactId"),email:Cookies.get("activeCampaignContactEmail"),intercomConversationsData:a}})},checkIfUserHasCallData:function(){var a=Cookies.get("callpageData");Cookies.get("activeCampaignContactId")&&Cookies.get("activeCampaignContactEmail")&&a&&this.updateCallpageData(a,Cookies.get("phoneNumber"))},saveCallInfo:function(a,b,c){var d="(Rozmowa umówiona na: "+a+") https://app.callpage.io/calls/call/"+b;Cookies.get("activeCampaignContactId")&&Cookies.get("activeCampaignContactEmail")?this.updateCallpageData(d,c):(Cookies.set("callpageData",d,{expires:730,path:"/"}),Cookies.set("phoneNumber",c,{expires:730,path:"/"}))},updateCallpageData:function(a,b){return $.ajax({url:"/"+App.getLang()+"/activeCampaign/updateContact",method:"POST",data:{id:Cookies.get("activeCampaignContactId"),email:Cookies.get("activeCampaignContactEmail"),callpageCallData:a,phone:b},success:function(){Cookies.remove("callpageData",{path:"/"}),Cookies.remove("phoneNumber",{path:"/"})}})}}),window.trackingActivitiesService=new App.Services.TrackingActivitiesService({el:$("body")});