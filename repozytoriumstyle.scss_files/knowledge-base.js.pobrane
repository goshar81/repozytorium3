App.Models.KnowledgeBase=Backbone.Model.extend({$view:function(){return this.get("$view")},hide:function(){this.$view().hide()},show:function(){this.$view().show()}}),App.Collections.KnowledgeBase=Backbone.Collection.extend({url:"/"+App.getLang()+"/knowledge-base-all",model:App.Models.KnowledgeBase}),App.Views.KnowledgeBaseTable=Backbone.View.extend({events:{"change .sort-by-technology":"sortKnowledgeElementByTechnology","change .filter":"filterKnowledgeElements","keyup .search":"searchKnowledgeElements"},initialize:function(a){this.filters={},this.searchText="",this.collection=new App.Collections.KnowledgeBase,this.collection.fetch().done($.proxy(this.render,this))},render:function(){this.$el.find("tbody").append(this.collection.map(function(a){var b=new App.Views.KnowledgeBaseRow({model:a});return a.set("$view",b.$el),b.$el})),this.setStartingSortKnowledgeElementByTechnology()},setStartingSortKnowledgeElementByTechnology:function(){var a=Cookies.get("kb_technology");"undefined"==typeof a?a=this.$el.find(".sort-by-technology").val():this.$el.find(".sort-by-technology").val(a),this.filters.technology=a,this.clearCheckedSelectOptions(),this.filter(),this.setSelectOptionsByTechnology(),Cookies.set("kb_technology",a,{expires:1e3})},sortKnowledgeElementByTechnology:function(a){var b=$(a.currentTarget).val();this.filters.technology=b,this.clearCheckedSelectOptions(),this.filter(),this.setSelectOptionsByTechnology(),Cookies.set("kb_technology",b,{expires:1e3})},clearCheckedSelectOptions:function(){delete this.filters.type,delete this.filters.category,this.$el.find(".select-by-tech").val("")},setSelectOptionsByTechnology:function(){this.$el.find(".select-by-tech>option").hide(),this.$el.find('.select-by-tech>option[value=""]').show(),this.$el.find('.select-by-tech>option[value^="'+this.filters.technology.toLowerCase()+'_"]').show()},filterKnowledgeElements:function(a){var b=$(a.currentTarget);""===b.val()?delete this.filters[b.attr("name")]:this.filters[b.attr("name")]=b.val(),this.filter()},filter:function(){var a=this;this.collection.invoke("hide");var b=this.collection.where(this.filters);this.searchText.length>=3&&(b=b.filter(function(b){if(b.get("name").toLowerCase().indexOf(a.searchText)>=0||b.get("description").toLowerCase().indexOf(a.searchText)>=0)return b})),b=new Backbone.Collection(b),b.invoke("show"),this.$el.removeClass("tech-html tech-css"),this.$el.addClass("tech-"+this.filters.technology.toLowerCase()),this.$el.find("table td, table th").show(),this.$el.find("table .hide-for-"+this.filters.technology.toLowerCase()).hide()},searchKnowledgeElements:function(a){var b=this;this.searchText=$(a.currentTarget).val().toLowerCase(),clearTimeout(this.searchKnowledgeElementsTimeout),this.searchText.length>=3?this.searchKnowledgeElementsTimeout=setTimeout(function(){b.filter()},500):this.searchKnowledgeElementsTimeout=setTimeout(function(){b.searchText="",b.filter()},500)}}),App.Views.KnowledgeBaseRow=Backbone.View.extend({tagName:"tr",hide:function(){this.$el.hide()},initialize:function(a){this.model=a.model,this.render()},render:function(){this.$el.html(App.Templates("knowledgeBaseRow")(this.model.toJSON()))}});